<!-- GET / -->
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Proyecto-Integrador</title>
    <link rel="stylesheet" href="vendor/css/bootstrap.min.css" />
    <link rel="stylesheet" href="resources/css/style.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Tienda</h1>
      </header>

      <main id="view"></main>
    </div>

    <!--Libs-->

    <!--Requerimiento : El código de Handlebars debe estar precargado 
                        en el HTML.-->
    <script src="vendor/js/handlebars.min.js"></script>

    <script>
      /*  1-- Crear la función HomePage, que englobe todo
        el código hasta ahora de la página de inicio    
    */
     /*con el evento DOMContentLoaded nos aseguramos que el dom esté completamente cargado
      antes de ejecutar cualquier codigo
     */
    document.addEventListener('DOMContentLoaded', () => {

      function HomePage() {

        const page = Handlebars.compile(`<div class="index-page">
    
    <form id="search-form">
       
        <div>
            <span>Nombre</span>
            <input  type="search" id="search-box" class="form-control" placeholder="Buscar ...">
        </div>        
        
        <div class="container">
            <button class="btn" type="submit">Buscar</button>        
        </div>

        <div>
            <p class="orderBy-text">Ordenar por...</p>
            <select name="orderBy" id="orderBy" class="form-control">
                <option value="nada">-</option>
                <option value="mayorPrecio">Mayor precio</option>
                <option value="menorPrecio">Menor precio</option>
            </select>
        </div>
       
    </form>

    <div class="article-list">

        {{#each articulos}}
        <div class="article" data-id="{{this.id}}">
            <div class="image" style="background-image: url({{this.urlImagen}});"></div>
            <div class="content">
                <div class="article-title">{{this.nombre}}</div>
                <div class="article-price">
                    <span class="article-price-currency">$</span>
                    <span class="article-price-value">{{this.precio}}</span>
                </div>
            </div>
        </div>
        {{/each}}

    </div>

</div>`);
        /*
        Requerimiento : El listado debe estar precargado en código.
        */
        let articulos = [
          {
            nombre: "Unbranded Cotton Shoes",
            descripcion:
              "Boston's most advanced compression wear technology increases muscle oxygenation, stabilizes active muscles",
            precio: "15.00",
            urlImagen: "http://loremflickr.com/640/480/technics",
            id: "4",
          },
          {
            nombre: "Modern Frozen Chair",
            descripcion:
              "The slim & simple Maple Gaming Keyboard from Dev Byte comes with a sleek body and 7- Color RGB LED Back-lighting for smart functionality",
            precio: "300.00",
            urlImagen: "http://loremflickr.com/640/480/technics",
            id: "5",
          },
          {
            nombre: "Oriental Rubber Car",
            descripcion:
              "The slim & simple Maple Gaming Keyboard from Dev Byte comes with a sleek body and 7- Color RGB LED Back-lighting for smart functionality",
            precio: "80.00",
            urlImagen: "http://loremflickr.com/640/480/technics",
            id: "6",
          },
          {
            nombre: "Awesome Plastic Bacon",
            descripcion:
              "Andy shoes are designed to keeping in mind durability as well as trends, the most stylish range of shoes & sandals",
            precio: "144.00",
            urlImagen: "http://loremflickr.com/640/480/technics",
            id: "7",
          },
          {
            nombre: "Recycled Metal Ball",
            descripcion:
              "The automobile layout consists of a front-engine design, with transaxle-type transmissions mounted at the rear of the engine and four wheel drive",
            precio: "800.00",
            urlImagen: "http://loremflickr.com/640/480/technics",
            id: "8",
          },
          {
            nombre: "Handcrafted Concrete Towels",
            descripcion:
              "Ergonomic executive chair upholstered in bonded black leather and PVC padded seat and back for all-day comfort and support",
            precio: "605.00",
            urlImagen: "http://loremflickr.com/640/480/technics",
            id: "9",
          },
          {
            nombre: "Handmade Bronze Salad",
            descripcion:
              "The Nagasaki Lander is the trademarked name of several series of Nagasaki sport bikes, that started with the 1984 ABC800J",
            precio: "566.00",
            urlImagen: "http://loremflickr.com/640/480/technics",
            id: "11",
          },
          {
            nombre: "Bespoke Bronze Keyboard",
            descripcion:
              "The Football Is Good For Training And Recreational Purposes",
            precio: "587.00",
            urlImagen: "http://loremflickr.com/640/480/technics",
            id: "12",
          },
          {
            nombre: "Awesome Cotton Gloves",
            descripcion:
              "New range of formal shirts are designed keeping you in mind. With fits and styling that will make you stand apart",
            precio: "391.00",
            urlImagen: "http://loremflickr.com/640/480/technics",
            id: "13",
          },
          {
            nombre: "Handmade Concrete Bacon",
            descripcion:
              "Andy shoes are designed to keeping in mind durability as well as trends, the most stylish range of shoes & sandals",
            precio: "306.00",
            urlImagen: "http://loremflickr.com/640/480/technics",
            id: "14",
          },
        ];

        document.getElementById("view").innerHTML = page({
           articulos,
        });

        /*
        1.c. Dentro del listener, evaluar el valor actual
            del select y aplicar la estrategia de
            ordenamiento correspondiente según el
            precio
        */

        document.getElementById("orderBy").addEventListener('change', function (e) {
          const selectedValue = e.target.value;
          console.log("tratando en evento del search box...");
          console.log("Se ha seleccionado la opción:", selectedValue);
          switch (e.target.value) {
            case "mayorPrecio":
              articulos = articulos.sort((a, b) =>
                Number(a.precio) < Number(b.precio) ? 1 : -1
              );
              break;
            case "menorPrecio":
              articulos = articulos.sort((a, b) =>
                Number(a.precio) > Number(b.precio) ? 1 : -1
              );
              break;
          }

          /*
          1.d. Finalmente, renderizar nuevamente la página.
          */
          document.getElementById("view").innerHTML = page({
            articulos,
          });
        });

        const searchBox = document.getElementById("search-box");
        
        document.getElementById("search-box").addEventListener('change', (e) => {

          console.log("dentro del evento de search box ....");
            
          const artsFiltered = articulos.filter( (item) => item.nombre.toLowerCase().includes(searchBox.value.toLowerCase()) );
            
          document.getElementById("view").innerHTML = page({ articulos:artsFiltered, });

        });

        const searchForm = document.getElementById('search-form');

        searchForm.addEventListener('submit', (e) => {
            e.preventDefault();  // Prevenir el comportamiento por defecto del formulario
            console.log("Formulario enviado, pero comportamiento prevenido.");
        });
      
      } // function HomePage
       
      HomePage();
          
    });

    </script>
  </body>
</html>